# TODO Use ~/.ssh/config!
function sshrun(){
    if [ "$2" != "" ]
    then
        ssh $@
    else
        #rsync -ae ssh ~/.bashrc ~/.prompt $1:~/
        rsync -ae ssh --delete ~/.prompt $1:~/
        ssh -X $1 "bash ~/.prompt/setup-host"
        ssh -X -t $1 "bash --rcfile ~/.bashrc"
    fi
}
 alias ssh=sshrun

# TODO Use ~/.ssh/config!
function sshaws(){
    rsync -ae "ssh -i $HOME/.ssh/default-user@all-ec2" --delete ~/.prompt ubuntu@$1:~/
    ssh -i $HOME/.ssh/default-user@all-ec2 ubuntu@$1 'rm -f /home/ubuntu/.bashrc; ln -s /home/ubuntu/.prompt/home/.bashrc /home/ubuntu/.bashrc'
    ssh -i $HOME/.ssh/default-user@all-ec2 ubuntu@$1
}

function dapi(){
    command="$@"
    sudo su dapi -c "$command"
}

function rs(){
    if [[ `uname` != "Darwin" ]]; then
        rsync -haz --info=progress2 $@
    else
        rsync -haz --progress $@
    fi
}

function gclone(){
    team=donjohnston
    repo=$1
    if [[ "$2" != "" ]]; then
        repo=$2
        team=$1
    fi
    git clone git@bitbucket.org:$team/$repo.git
}

function on_bash_exit(){
    if [[ -f $HOME/.bashrc.bak ]]; then
      mv $HOME/.bashrc.bak $HOME/.bashrc
    fi
}

function pstorm(){
    /usr/local/bin/phpstorm/bin/phpstorm.sh $@ > /dev/null 2>&1 &

}
