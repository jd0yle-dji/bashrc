# TODO Use ~/.ssh/config!
function sshrun(){
    if [ "$2" != "" ]
    then
        ssh $@
    else
        #rsync -ae ssh ~/.bashrc ~/.prompt $1:~/
        rsync -ae ssh --delete ~/.prompt $1:~/
        ssh -Y $1 "bash ~/.prompt/setup-host"
        ssh -Y -t $1 "bash --rcfile ~/.prompt/home/.bashrc"
    fi
}
alias ssh=sshrun

function m_sshWrapper(){
    keyFileName=$1
    address=$2
    echo "Syncing .prompt files"
    rsync -ae "ssh -i $HOME/.ssh/${keyFileName}" --delete ~/.prompt ubuntu@${address}:~/
    echo "Setting .bashrc"
    ssh -i $HOME/.ssh/${keyFileName} ubuntu@${address} 'rm -f /home/ubuntu/.bashrc; ln -s /home/ubuntu/.prompt/home/.bashrc /home/ubuntu/.bashrc'
    echo "Connecting"
    ssh -i $HOME/.ssh/${keyFileName} ubuntu@${address}
}

function sshdev(){
    m_sshWrapper aws-dev-2017-01-04_22-15 $1
}

function sshqa(){
    m_sshWrapper aws-qa-2017-01-04_22-15 $1
}

function sshstage(){
    m_sshWrapper aws-stage-2017-01-04_22-15 $1
}

function sshprod(){
    m_sshWrapper aws-prod-2017-01-04_22-15 $1
}


# TODO Use ~/.ssh/config!
function sshaws(){
    echo "Syncing .prompt files"
    rsync -ae "ssh -i $HOME/.ssh/default-user@all-ec2" --delete ~/.prompt ubuntu@$1:~/
    echo "Setting .bashrc"
    ssh -i $HOME/.ssh/default-user@all-ec2 ubuntu@$1 'rm -f /home/ubuntu/.bashrc; ln -s /home/ubuntu/.prompt/home/.bashrc /home/ubuntu/.bashrc'
    echo "Connecting"
    ssh -i $HOME/.ssh/default-user@all-ec2 ubuntu@$1
}

function dapi(){
    command="$@"
    sudo su dapi -c "$command"
}

function rs(){
    if [[ `uname` != "Darwin" ]]; then
        rsync -haz --info=progress2 $@
    else
        rsync -haz --progress $@
    fi
}

function gclone(){
    team=donjohnston
    repo=$1
    if [[ "$2" != "" ]]; then
        repo=$2
        team=$1
    fi
    git clone git@bitbucket.org:$team/$repo.git
}


function du {
    if [[ `uname` != "Darwin" ]]; then
        du -h --max-depth=1 $@
    else
        du -hc -d 1 $@
    fi
}
